{{define "subject"}}[CVErt Ops] Alert: {{.RuleName}} â€” {{len .CVEs}} CVE(s){{end}}
{{define "body"}}<!DOCTYPE html>
<html lang="en">
<head><meta charset="utf-8"><meta name="viewport" content="width=device-width"></head>
<body style="margin:0;padding:0;background:#f4f4f7;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Helvetica,Arial,sans-serif">
<table width="100%" cellpadding="0" cellspacing="0" style="background:#f4f4f7;padding:24px 0">
<tr><td align="center">
<table width="600" cellpadding="0" cellspacing="0" style="background:#fff;border-radius:8px;overflow:hidden">
  <tr><td style="background:#1a1a2e;padding:20px 24px">
    <span style="color:#fff;font-size:18px;font-weight:600">CVErt Ops Alert</span>
  </td></tr>
  <tr><td style="padding:24px">
    <p style="margin:0 0 4px;color:#555;font-size:13px">Rule: <strong>{{.RuleName}}</strong></p>
    <p style="margin:0 0 16px;color:#555;font-size:13px">Matched <strong>{{len .CVEs}}</strong> CVE(s)</p>

    <table width="100%" cellpadding="0" cellspacing="0" style="border-collapse:collapse">
      <tr style="background:#f8f9fa">
        <th style="text-align:left;padding:8px 12px;font-size:12px;color:#666;border-bottom:2px solid #dee2e6">CVE</th>
        <th style="text-align:left;padding:8px 12px;font-size:12px;color:#666;border-bottom:2px solid #dee2e6">Severity</th>
        <th style="text-align:left;padding:8px 12px;font-size:12px;color:#666;border-bottom:2px solid #dee2e6">Scores</th>
        <th style="text-align:left;padding:8px 12px;font-size:12px;color:#666;border-bottom:2px solid #dee2e6">Flags</th>
      </tr>
      {{range .CVEs}}
      <tr>
        <td style="padding:10px 12px;border-bottom:1px solid #eee;font-size:13px">
          {{- if .DetailURL}}<a href="{{.DetailURL}}" style="color:#0066cc;text-decoration:none">{{.CVEID}}</a>
          {{- else}}{{.CVEID}}{{end}}
        </td>
        <td style="padding:10px 12px;border-bottom:1px solid #eee;font-size:13px">
          <span style="display:inline-block;padding:2px 8px;border-radius:4px;font-size:11px;font-weight:600;color:#fff;background:{{sevColor .Severity}}">{{.Severity}}</span>
        </td>
        <td style="padding:10px 12px;border-bottom:1px solid #eee;font-size:12px;color:#555">
          {{- if .CVSSV3Score}}v3:&nbsp;{{printf "%.1f" (deref .CVSSV3Score)}}{{end}}
          {{- if .CVSSV4Score}} v4:&nbsp;{{printf "%.1f" (deref .CVSSV4Score)}}{{end}}
          {{- if .EPSSScore}} EPSS:&nbsp;{{printf "%.2f%%" (pct (deref .EPSSScore))}}{{end}}
        </td>
        <td style="padding:10px 12px;border-bottom:1px solid #eee;font-size:12px">
          {{- if .ExploitAvail}}<span style="color:#dc3545" title="Exploit available">&#9888;</span> {{end}}
          {{- if .InCISAKEV}}<span style="color:#fd7e14" title="CISA KEV">KEV</span>{{end}}
        </td>
      </tr>
      <tr><td colspan="4" style="padding:4px 12px 10px;font-size:12px;color:#666;border-bottom:1px solid #eee">{{.Description}}</td></tr>
      {{end}}
    </table>
  </td></tr>
  {{if .CVErtOpsURL}}
  <tr><td style="padding:16px 24px;background:#f8f9fa;text-align:center">
    <a href="{{.CVErtOpsURL}}" style="color:#0066cc;font-size:13px">View in CVErt Ops</a>
  </td></tr>
  {{end}}
</table>
</td></tr>
</table>
</body>
</html>{{end}}
